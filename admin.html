<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏¥‡∏ß‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£ (Admin Full)</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 30px; background-color: #f0f4f8; }
        .container { 
            background-color: white; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15); 
            max-width: 700px; 
            margin: auto; 
            display: flex; 
            gap: 30px; 
            flex-wrap: wrap; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏° Reset ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ */
        }
        .section { flex: 1; padding: 15px; border-radius: 8px; min-width: 300px; }
        
        .add-section { background-color: #e6f7ff; border: 2px solid #337ab7; }
        #new-queue-display { font-size: 3em; font-weight: bold; color: #ff8c00; margin: 15px 0; }
        #btn-add-queue { background-color: #337ab7; }

        .call-section { background-color: #e6ffed; border: 2px solid #5cb85c; }
        #current-queue-display { font-size: 3em; font-weight: bold; color: #5cb85c; margin: 15px 0; }
        #btn-call-next { background-color: #5cb85c; }
        
        #btn-reset { background-color: #d9534f; margin-top: 20px; width: 100%;} /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï */

        button { color: white; border: none; padding: 10px 20px; font-size: 1.1em; border-radius: 6px; cursor: pointer; transition: background-color 0.3s; width: 100%; }
        button:hover { filter: brightness(1.1); }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        .message { margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="section add-section">
            <h2>üì¢ ‡∏≠‡∏≠‡∏Å‡∏ö‡∏±‡∏ï‡∏£‡∏Ñ‡∏¥‡∏ß</h2>
            <p>‡∏Ñ‡∏¥‡∏ß‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡∏Å:</p>
            <div id="new-queue-display">A???</div>
            <button id="btn-add-queue">‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏¥‡∏ß‡πÉ‡∏´‡∏°‡πà</button>
            <p id="add-status-msg" class="message" style="color: #337ab7;"></p>
        </div>

        <div class="section call-section">
            <h2>üìû ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏¥‡∏ß</h2>
            <p>‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (Current Call):</p>
            <div id="current-queue-display">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            <button id="btn-call-next" disabled>‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏¥‡∏ß‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
            <p id="call-status-msg" class="message" style="color: #5cb85c;"></p>
        </div>
        
        <div style="width: 100%; text-align: center;">
            <button id="btn-reset" style="background-color: #d9534f; margin-top: 20px;">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏¥‡∏ß‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button>
            <p id="reset-status-msg" class="message" style="color: #d9534f;"></p>
        </div>
        
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // 1. üîë ‡πÇ‡∏Ñ‡πâ‡∏î Firebase Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì üîë (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß)
        const firebaseConfig = {
            apiKey: "AIzaSyB4ZlLgm23n_7E_vWjV2CJlVamfFy1ILrM",
            authDomain: "project01-55da2.firebaseapp.com",
            databaseURL: "https://project01-55da2-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "project01-55da2",
            storageBucket: "project01-55da2.firebasestorage.app",
            messagingSenderId: "81556455932",
            appId: "1:81556455932:web:b4aafe9bafd06b7a9f3279",
            measurementId: "G-L4DLG93C5N"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const lastNumRef = db.ref('Counters/last_queue_number');
        const queuesListRef = db.ref('QueuesList');
        const currentQueueRef = db.ref('QueueStatus/current_queue');

        let currentCall = ""; 
        let isReady = false;

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ---
        function formatQueueId(number) {
            return "A" + number.toString().padStart(3, '0');
        }
        function getMessageElement(type) {
            if (type === 'add') return document.getElementById('add-status-msg');
            if (type === 'call') return document.getElementById('call-status-msg');
            if (type === 'reset') return document.getElementById('reset-status-msg');
        }

        // --- 1. ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏¥‡∏ß‡πÉ‡∏´‡∏°‡πà (Add Queue) ---

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏≠‡∏≠‡∏Å
        lastNumRef.on('value', (snapshot) => {
            const lastNum = snapshot.val() || 0;
            const nextId = formatQueueId(lastNum + 1);
            document.getElementById('new-queue-display').innerText = nextId;
        });

        document.getElementById('btn-add-queue').addEventListener('click', () => {
            document.getElementById('btn-add-queue').disabled = true;
            getMessageElement('add').innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...';

            lastNumRef.transaction((currentNumber) => {
                // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ (null) ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà 1
                return (currentNumber || 0) + 1;
            }).then(({ committed, snapshot }) => {
                if (committed) {
                    const newNumber = snapshot.val();
                    const newQueueId = formatQueueId(newNumber);
                    
                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏¥‡∏ß‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô QueuesList ‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "Waiting"
                    queuesListRef.child(newQueueId).set("Waiting")
                        .then(() => {
                            getMessageElement('add').innerText = `‡∏≠‡∏≠‡∏Å‡∏ö‡∏±‡∏ï‡∏£‡∏Ñ‡∏¥‡∏ß ${newQueueId} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!`;
                        });
                    
                    // ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏¥‡∏ß‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏¥‡∏ß‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å
                    currentQueueRef.once('value').then(currentSnap => {
                        if (!currentSnap.exists() || currentSnap.val() === "A000" || currentSnap.val() === "---") {
                             currentQueueRef.set(newQueueId);
                        }
                    });

                }
                document.getElementById('btn-add-queue').disabled = false;
            });
        });

        // --- 2. ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏¥‡∏ß (Call Next) ---
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏´‡πâ Admin ‡πÄ‡∏´‡πá‡∏ô)
        currentQueueRef.on('value', (snapshot) => {
            currentCall = snapshot.val() || "---";
            document.getElementById('current-queue-display').innerText = currentCall;
            document.getElementById('btn-call-next').disabled = false;
            isReady = true;
            getMessageElement('call').innerText = '‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
        });

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏≤‡∏Ñ‡∏¥‡∏ß‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏ó‡∏µ‡πà "Waiting" ‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (QueuesList)
        function findNextQueue(queuesList) {
            let nextQueueId = null;

            // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á key (A001, A002, ...)
            for (const key in queuesList) {
                if (queuesList[key] === "Waiting") {
                    nextQueueId = key;
                    break; // ‡∏û‡∏ö‡∏Ñ‡∏¥‡∏ß‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏õ
                }
            }
            return nextQueueId;
        }

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°
        document.getElementById('btn-call-next').addEventListener('click', () => {
            if (!isReady) return;
            document.getElementById('btn-call-next').disabled = true;
            getMessageElement('call').innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...';

            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏°‡∏≤
            queuesListRef.once('value').then(listSnapshot => {
                const queuesList = listSnapshot.val();

                // 1. ‡∏´‡∏≤‡∏Ñ‡∏¥‡∏ß‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô "Waiting"
                const nextQueue = findNextQueue(queuesList);

                if (nextQueue) {
                    // 2. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô "Done" (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô A000 ‡∏´‡∏£‡∏∑‡∏≠ ---)
                    if (currentCall !== "A000" && currentCall !== "---" && queuesList[currentCall] === "Waiting") {
                         db.ref('QueuesList/' + currentCall).set("Done");
                    }
                    
                    // 3. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏¥‡∏ß‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡πÄ‡∏´‡πá‡∏ô (‡πÉ‡∏ô QueueStatus)
                    currentQueueRef.set(nextQueue)
                        .then(() => {
                            getMessageElement('call').innerText = `‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏¥‡∏ß ${nextQueue} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`;
                        });
                } else {
                    currentQueueRef.set("---"); // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏¥‡∏ß‡πÅ‡∏•‡πâ‡∏ß
                    getMessageElement('call').innerText = '‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß';
                }
                 document.getElementById('btn-call-next').disabled = false;
            }).catch(error => {
                getMessageElement('call').innerText = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message;
                document.getElementById('btn-call-next').disabled = false;
            });
        });

        // --- 3. ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏¥‡∏ß (Reset) ---

        document.getElementById('btn-reset').addEventListener('click', () => {
            if (!confirm("‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ!")) {
                return;
            }

            document.getElementById('btn-reset').disabled = true;
            getMessageElement('reset').innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
            
            // 1. ‡∏ï‡∏±‡πâ‡∏á Counter ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà 0
            lastNumRef.set(0)
            
            // 2. ‡∏ï‡∏±‡πâ‡∏á current_queue ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà A000
            .then(() => currentQueueRef.set("A000"))
            
            // 3. ‡∏•‡∏ö QueuesList ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô A000: "Done" ‡πÉ‡∏´‡∏°‡πà
            .then(() => queuesListRef.set({ "A000": "Done" }))
            
            .then(() => {
                getMessageElement('reset').innerText = '‚úÖ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏¥‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà';
                document.getElementById('btn-reset').disabled = false;
            })
            .catch((error) => {
                getMessageElement('reset').innerText = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï: ' + error.message;
                document.getElementById('btn-reset').disabled = false;
            });
        });

    </script>
</body>
</html>
